(function(e){function t(t){for(var n,o,s=t[0],u=t[1],c=t[2],l=0,f=[];l<s.length;l++)o=s[l],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&f.push(i[o][0]),i[o]=0;for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(e[n]=u[n]);d&&d(t);while(f.length)f.shift()();return a.push.apply(a,c||[]),r()}function r(){for(var e,t=0;t<a.length;t++){for(var r=a[t],n=!0,o=1;o<r.length;o++){var s=r[o];0!==i[s]&&(n=!1)}n&&(a.splice(t--,1),e=u(u.s=r[0]))}return e}var n={},o={app:0},i={app:0},a=[];function s(e){return u.p+"js/"+({login:"login",settings:"settings"}[e]||e)+"."+{login:"ab5f4fe4",settings:"bce25edd"}[e]+".js"}function u(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,u),r.l=!0,r.exports}u.e=function(e){var t=[],r={settings:1};o[e]?t.push(o[e]):0!==o[e]&&r[e]&&t.push(o[e]=new Promise((function(t,r){for(var n="css/"+({login:"login",settings:"settings"}[e]||e)+"."+{login:"31d6cfe0",settings:"9cc4389a"}[e]+".css",i=u.p+n,a=document.getElementsByTagName("link"),s=0;s<a.length;s++){var c=a[s],l=c.getAttribute("data-href")||c.getAttribute("href");if("stylesheet"===c.rel&&(l===n||l===i))return t()}var f=document.getElementsByTagName("style");for(s=0;s<f.length;s++){c=f[s],l=c.getAttribute("data-href");if(l===n||l===i)return t()}var d=document.createElement("link");d.rel="stylesheet",d.type="text/css",d.onload=t,d.onerror=function(t){var n=t&&t.target&&t.target.src||i,a=new Error("Loading CSS chunk "+e+" failed.\n("+n+")");a.code="CSS_CHUNK_LOAD_FAILED",a.request=n,delete o[e],d.parentNode.removeChild(d),r(a)},d.href=i;var p=document.getElementsByTagName("head")[0];p.appendChild(d)})).then((function(){o[e]=0})));var n=i[e];if(0!==n)if(n)t.push(n[2]);else{var a=new Promise((function(t,r){n=i[e]=[t,r]}));t.push(n[2]=a);var c,l=document.createElement("script");l.charset="utf-8",l.timeout=120,u.nc&&l.setAttribute("nonce",u.nc),l.src=s(e);var f=new Error;c=function(t){l.onerror=l.onload=null,clearTimeout(d);var r=i[e];if(0!==r){if(r){var n=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src;f.message="Loading chunk "+e+" failed.\n("+n+": "+o+")",f.name="ChunkLoadError",f.type=n,f.request=o,r[1](f)}i[e]=void 0}};var d=setTimeout((function(){c({type:"timeout",target:l})}),12e4);l.onerror=l.onload=c,document.head.appendChild(l)}return Promise.all(t)},u.m=e,u.c=n,u.d=function(e,t,r){u.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},u.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.t=function(e,t){if(1&t&&(e=u(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(u.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)u.d(r,n,function(t){return e[t]}.bind(null,n));return r},u.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return u.d(t,"a",t),t},u.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},u.p="/Vue-InsideroViewer/",u.oe=function(e){throw console.error(e),e};var c=window["webpackJsonp"]=window["webpackJsonp"]||[],l=c.push.bind(c);c.push=t,c=c.slice();for(var f=0;f<c.length;f++)t(c[f]);var d=l;a.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"10c1":function(e,t,r){},"56d7":function(e,t,r){"use strict";r.r(t);r("96cf");var n=r("1da1"),o=(r("e260"),r("e6cf"),r("cca6"),r("a79d"),r("2b0e")),i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-container",{attrs:{id:"app"}},[r("SiteNav"),r("router-view")],1)},a=[],s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-navbar",{attrs:{toggleable:"md",type:"dark",variant:"primary"}},[r("b-navbar-brand",{attrs:{to:{path:"/"}}},[e._v("Insidero Viewer")]),r("b-navbar-toggle",{attrs:{target:"nav-collapse"}}),r("b-collapse",{attrs:{id:"nav-collapse","is-nav":""}},[e.isLoggedIn?r("b-navbar-nav",e._l(e.userProfile.userLocations,(function(t){return r("b-nav-item",{key:t.city.value,attrs:{active:t.city.value===e.$route.query.city},on:{click:function(r){return e.setLocation(t)}}},[e._v(" "+e._s(t.city.text)+" ")])})),1):e._e(),r("b-navbar-nav",{staticClass:"ml-auto"},[r("b-nav-item-dropdown",{attrs:{right:""},scopedSlots:e._u([{key:"button-content",fn:function(){return[r("em",[e._v("User")])]},proxy:!0}])},[e.isLoggedIn?e._e():r("b-dropdown-item",{attrs:{to:{path:"login"}}},[e._v("Login")]),e.isLoggedIn?r("b-dropdown-item",{attrs:{to:{path:"settings"}}},[e._v("Settings")]):e._e(),e.isLoggedIn?r("b-dropdown-item",{on:{click:function(t){return e.logout()}}},[e._v("Sign Out")]):e._e()],1)],1)],1)],1)},u=[],c=r("5530"),l=r("2f62"),f=r("dc59"),d={data:function(){return{currentQuery:{}}},computed:Object(c["a"])(Object(c["a"])({},Object(l["b"])(["userProfile"])),{},{isLoggedIn:function(){var e=null!=f["a"].currentUser;return e}}),methods:{logout:function(){this.$store.dispatch("logout")},setLocation:function(e){var t={country:e.country.value,region:e.region.value,city:e.city.value};this.$router.push({path:"/offers",query:t})}}},p=d,g=r("2877"),h=Object(g["a"])(p,s,u,!1,null,null,null),v=h.exports,m={name:"App",components:{SiteNav:v}},b=m,y=Object(g["a"])(b,i,a,!1,null,null,null),w=y.exports,_=(r("45fc"),r("d3b7"),r("8c4f")),k=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-container",{attrs:{fluid:"xl"}},[r("OffersList",{attrs:{items:e.offers,isLoading:e.isLoading},on:{updateCategory:e.updateCategory}})],1)},P=[],O=(r("c740"),r("4160"),r("b64b"),r("07ac"),r("25f0"),r("3ca3"),r("159b"),r("ddb0"),r("2b3d"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-container",{attrs:{fluid:"xl"}},[r("b-overlay",{attrs:{show:e.isLoading,rounded:"sm"}},[(e.favorites||[]).length>0?r("h3",[e._v("Favorites")]):e._e(),(e.favorites||[]).length>0?r("OffersTable",{attrs:{fields:e.fields,offers:e.favorites},on:{toggleArchive:e.toggleArchive,toggleFavorite:e.toggleFavorite}}):e._e(),(e.untagged||[]).length>0?r("h3",[e._v("New")]):e._e(),(e.untagged||[]).length>0?r("OffersTable",{attrs:{fields:e.fields,offers:e.untagged},on:{toggleArchive:e.toggleArchive,toggleFavorite:e.toggleFavorite}}):e._e(),(e.archived||[]).length>0?r("h3",[e._v("Archived")]):e._e(),(e.archived||[]).length>0?r("OffersTable",{attrs:{fields:e.fields,offers:e.archived},on:{toggleArchive:e.toggleArchive,toggleFavorite:e.toggleFavorite}}):e._e()],1)],1)}),x=[],L=(r("99af"),r("4de4"),r("7db0"),r("d81d"),r("fb6a"),r("ac1f"),r("1276"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-table",{attrs:{items:e.offers,fields:e.fields,"sort-by":e.sortBy,"sort-desc":e.sortDesc,small:"",hover:"",striped:"",stacked:"sm"},on:{"update:sortBy":function(t){e.sortBy=t},"update:sort-by":function(t){e.sortBy=t},"update:sortDesc":function(t){e.sortDesc=t},"update:sort-desc":function(t){e.sortDesc=t}},scopedSlots:e._u([{key:"cell(show_details)",fn:function(t){return[r("b-button",{staticClass:"mr-2",attrs:{size:"sm"},on:{click:t.toggleDetails}},[e._v(" "+e._s(t.detailsShowing?"Less":"More")+" ")])]}},{key:"cell(id)",fn:function(t){return[r("a",{attrs:{href:""+t.item.urls.slice(-1)[0]["url"]}},[e._v(e._s(t.item.id))])]}},{key:"cell(favorite)",fn:function(t){return[r("b-button",{attrs:{size:"sm",variant:t.value?"primary":"outline-primary"},on:{click:function(r){return e.toggleFavorite(t.item)}}},[r("b-icon",{attrs:{icon:"heart"}})],1)]}},{key:"cell(archived)",fn:function(t){return[r("b-button",{attrs:{size:"sm",variant:t.value?"dark":"outline-dark"},on:{click:function(r){return e.toggleArchive(t.item)}}},[r("b-icon",{attrs:{icon:"archive"}})],1)]}},{key:"row-details",fn:function(t){return[r("b-card",[r("b-row",{attrs:{"no-gutters":""}},[r("b-col",{attrs:{md:"6"}},[r("b-card-body",{attrs:{title:"Urls"}},[r("b-table",{attrs:{items:t.item.urls,"thead-class":"hidden_header"},scopedSlots:e._u([{key:"cell(url)",fn:function(t){return[r("a",{attrs:{href:""+t.value}},[e._v(e._s(t.value))])]}}],null,!0)})],1)],1),t.item.prices?r("b-col",{attrs:{md:"6"}},[r("b-card-body",{attrs:{title:"Prices"}},[r("b-table",{attrs:{items:t.item.prices,"thead-class":"hidden_header"}})],1)],1):e._e(),t.item.updates?r("b-col",{attrs:{md:"6"}},[r("b-card-body",{attrs:{title:"Updates"}},[r("b-table",{attrs:{items:t.item.updates,"thead-class":"hidden_header"}})],1)],1):e._e(),r("b-col",{attrs:{md:"6"}},[r("GmapMap",{staticStyle:{width:"500px",height:"300px"},attrs:{center:t.item.marker.position,zoom:11,options:{gestureHandling:"greedy"},"map-type-id":"terrain"}},[r("GmapMarker",{key:t.item.id,attrs:{position:t.item.marker.position}})],1)],1)],1)],1)]}}])})}),j=[],S={name:"OffersTable",props:{fields:{},offers:{}},data:function(){return{sortBy:"updated",sortDesc:!0}},methods:{toggleFavorite:function(e){var t=this,r=new Promise((function(r){return t.$emit("toggleFavorite",e,r)}));return r.then((function(e){return console.log(e)})),r},toggleArchive:function(e){var t=this,r=new Promise((function(r){return t.$emit("toggleArchive",e,r)}));return r.then((function(e){return console.log(e)})),r}}},A=S,I=Object(g["a"])(A,L,j,!1,null,null,null),E=I.exports,C=r("2ef0"),R=r.n(C),U={name:"Offers",props:["items","isLoading"],components:{OffersTable:E},data:function(){return{fields:[{key:"id",sortable:!1},{key:"current_price",sortable:!0,label:"Price"},{key:"published",sortable:!0},{key:"updated",sortable:!0},{key:"subtype",sortable:!1},{key:"rooms",sortable:!1},{key:"size",sortable:!0},{key:"land",sortable:!0},{key:"favorite",sortable:!1,label:""},{key:"archived",sortable:!1,label:""},{key:"show_details",sortable:!1,label:""}]}},computed:Object(c["a"])(Object(c["a"])({},Object(l["b"])(["userProfile"])),{},{offers:function(){var e;if(null==(null===(e=this.userProfile)||void 0===e?void 0:e.offersHistory)||0===this.items.length)return[];var t=this.userProfile.offersHistory;return this.items.map((function(e){var r,n,o,i=e["general"]["id"],a=e["general"]["subtype"],s=e["price"],u=s?"".concat(s["current"]," ").concat(s["currency"]):"",c=s?s["max"]-s["current"]:null,l=c?"(-".concat(Math.round(c/s["max"]*1e3)/10,"%)"):"",f=s?[{type:"Min",price:"".concat(s["min"]," ").concat(s["currency"])},{type:"Max",price:"".concat(s["max"]," ").concat(s["currency"])},{type:"Current",price:u},{type:"PSQ",price:"".concat(s["perSquareMeter"]," ").concat(s["currency"])}]:null,d=e["events"],p=d?d["visibility"]["0"]["date"]:null,g=d?d["visibility"].slice(-1)[0]["date"]:null,h=d&&d["dataUpdates"]?d["dataUpdates"].map((function(e){return{date:e.date,type:e.type,value:"".concat(e.value.old," -> ").concat(e.value.new)}})):null,v=e["space"],m=(null===v||void 0===v||null===(r=v.room)||void 0===r?void 0:r.full)||"",b=null!==v&&void 0!==v&&v.room?"".concat((null===v||void 0===v||null===(n=v.room)||void 0===n?void 0:n.min)||"","/").concat((null===v||void 0===v||null===(o=v.room)||void 0===o?void 0:o.max)||"","/").concat(m):null,y=null!==v&&void 0!==v&&v.usable?"".concat(v["usable"]["min"],"m2"):null,w=null!==v&&void 0!==v&&v.land?"".concat(v["land"]["min"],"m2"):null,_=e["geography"]?e["geography"]["coordinates"][0]:null,k=_?{lat:parseFloat(_.split(",")[0]),lng:parseFloat(_.split(",")[1])}:null,P=k?{id:i,position:k}:null,O=t.find((function(e){return e.offerId===i})),x=(null===O||void 0===O?void 0:O.category)||0,L=e["general"]["url"].map((function(e){return{url:e}}));return{id:i,current_price:"".concat(u,"\n").concat(l),published:p,updated:g,updates:h,subtype:a,rooms:b,size:y,land:w,category:x,favorite:1===x,archived:10===x,prices:f,marker:P,urls:L}}))},favorites:function(){return R.a.filter(this.offers,(function(e){return e.favorite}))},archived:function(){return R.a.filter(this.offers,(function(e){return e.archived}))},untagged:function(){return R.a.filter(this.offers,(function(e){return!e.favorite&&!e.archived}))}}),methods:{updateCategory:function(e,t){var r=this,n={offer_id:t,category:e},o=new Promise((function(e){return r.$emit("updateCategory",n,e)}));return o.then((function(e){return console.log(e)})),o},toggleFavorite:function(e){var t=1===e.category?0:1;this.updateCategory(t,e.id)},toggleArchive:function(e){var t=10===e.category?0:10;this.updateCategory(t,e.id)}}},$=U,F=(r("c6e2"),Object(g["a"])($,O,x,!1,null,null,null)),T=F.exports,q={name:"Dashboard",data:function(){return{offersInfo:{},offers:[],isLoading:!1}},mounted:function(){null!=this.userProfile&&this.getOffers(this.$route.query)},components:{OffersList:T},computed:Object(c["a"])({},Object(l["b"])(["userProfile"])),watch:{$route:function(e,t){console.log("Route change: ",e.query),this.getOffers(e.query)},userProfile:function(e,t){null!=e&&null==this.offersInfo&&!1===this.isLoading&&this.getOffers(this.$route.query)}},methods:{getOffers:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function r(){var n,o,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:null!=e&&null!==(n=t.userProfile)&&void 0!==n&&n.apiKey&&(t.isLoading=!0,console.log("Getting offers...",t.userProfile.apiKey),o={api_key:t.userProfile.apiKey,country:e.country,region:e.region,city:e.city,type:e.type,offer:"sell",active:"true"},Object.keys(o).forEach((function(e){return null==o[e]&&delete o[e]})),i=new URLSearchParams(o).toString(),t.$axios.get("/offers?"+i).then((function(e){console.log("New offers received: ",Object.keys(e["data"]["results"]).length),t.offersInfo=e["data"]["info"],t.offers=Object.values(e["data"]["results"])})).catch((function(e){console.log(e.response)})).finally((function(){return t.isLoading=!1})));case 1:case"end":return r.stop()}}),r)})))()},updateCategory:function(e){this.userProfile.offersHistory||(this.userProfile.offersHistory=[]);var t=this.userProfile.offersHistory.findIndex((function(t){return t.offerId===e.offer_id})),r={offerId:e.offer_id,category:e.category};-1===t?this.userProfile.offersHistory.push(r):this.userProfile.offersHistory[t]=r,this.$store.dispatch("updateProfile",{apiKey:this.userProfile.apiKey,userLocations:this.userProfile.userLocations,offersHistory:this.userProfile.offersHistory})}}},B=q,H=Object(g["a"])(B,k,P,!1,null,null,null),D=H.exports;o["default"].use(_["a"]);var M=[{path:"/",name:"Dashboard",component:D,meta:{requiresAuth:!0}},{path:"/offers",name:"Dashboard",component:D,meta:{requiresAuth:!0}},{path:"/login",name:"Login",component:function(){return r.e("login").then(r.bind(null,"a55b"))}},{path:"/settings",name:"settings",component:function(){return r.e("settings").then(r.bind(null,"26d3"))},meta:{requiresAuth:!0}}],z=new _["a"]({mode:"history",base:"/Vue-InsideroViewer/",routes:M});z.beforeEach((function(e,t,r){var n=e.matched.some((function(e){return e.meta.requiresAuth})),o=null!=f["a"].currentUser;if(!n||o)if("/"===e.path&&o)if(R.a.isEmpty(K.getters["userLocations"]))r("/settings");else{var i=K.getters["userLocations"][0];r({path:"/offers",query:{country:i.country.value,region:i.region.value,city:i.city.value}})}else r();else r("/login")})),o["default"].use(l["a"]);var K=new l["a"].Store({state:{userProfile:{}},mutations:{setUserProfile:function(e,t){e.userProfile=t}},getters:{userLocations:function(e){var t;return null===(t=e.userProfile)||void 0===t?void 0:t.userLocations}},actions:{login:function(e,t){return Object(n["a"])(regeneratorRuntime.mark((function r(){var n,o,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.dispatch,r.next=3,f["a"].signInWithEmailAndPassword(t.email,t.password);case 3:o=r.sent,i=o.user,n("fetchUserProfile",i);case 6:case"end":return r.stop()}}),r)})))()},signup:function(e,t){return Object(n["a"])(regeneratorRuntime.mark((function r(){var n,o,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.dispatch,r.next=3,f["a"].createUserWithEmailAndPassword(t.email,t.password);case 3:return o=r.sent,i=o.user,r.next=7,f["b"].doc(i.uid).set({apiKey:""});case 7:n("fetchUserProfile",i);case 8:case"end":return r.stop()}}),r)})))()},fetchUserProfile:function(e,t){return Object(n["a"])(regeneratorRuntime.mark((function r(){var n,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,r.next=3,f["b"].doc(t.uid).get();case 3:o=r.sent,n("setUserProfile",o.data()),"/login"===z.currentRoute.path&&z.push("/");case 6:case"end":return r.stop()}}),r)})))()},logout:function(e){return Object(n["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.commit,t.next=3,f["a"].signOut();case 3:r("setUserProfile",{}),z.push("/login");case 5:case"end":return t.stop()}}),t)})))()},updateProfile:function(e,t){return Object(n["a"])(regeneratorRuntime.mark((function r(){var n,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.dispatch,o=f["a"].currentUser.uid,r.next=4,f["b"].doc(o).update({apiKey:t.apiKey,userLocations:t.userLocations,offersHistory:t.offersHistory});case 4:r.sent,n("fetchUserProfile",{uid:o});case 6:case"end":return r.stop()}}),r)})))()}}}),N=r("755e"),V=r("5f5b"),G=r("b1e0"),Z=(r("f9e3"),r("2dd8"),r("bc3a")),Y=r.n(Z),J=r("9955"),Q=r.n(J);o["default"].use(V["a"]),o["default"].use(G["a"]),o["default"].use(N,{load:{key:"AIzaSyBuPTri_r03eY5dY2vwzgRBcYsCl6Tl3B4"}});var W,X={baseURL:" https://api.insidero.com/v3",timeout:3e4};o["default"].prototype.$axios=Y.a.create(X),o["default"].use(Q.a,{lodash:R.a}),o["default"].config.productionTip=!1,f["a"].onAuthStateChanged(function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t){e.next=3;break}return e.next=3,K.dispatch("fetchUserProfile",t);case 3:W||(W=new o["default"]({router:z,store:K,render:function(e){return e(w)}}).$mount("#app"));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},c6e2:function(e,t,r){"use strict";r("10c1")},dc59:function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return s}));var n=r("260b"),o=(r("ea7b"),r("e71f"),{apiKey:"AIzaSyBZwhyuBZh0IpaZRSIv5N0FFYqCtZBSMVE",authDomain:"insideroviewer.firebaseapp.com",projectId:"insideroviewer",storageBucket:"insideroviewer.appspot.com",messagingSenderId:"72743309203",appId:"1:72743309203:web:01134561f8400403082266",measurementId:"G-PT3FG19EPZ"});n["a"].initializeApp(o);var i=n["a"].firestore(),a=n["a"].auth(),s=i.collection("users")}});
//# sourceMappingURL=app.cc813a8a.js.map